.. _sf formats:

Различные форматы SoundFont
===========================

Polyphone может работать с несколькими форматами SoundFont:

* `sf2   <sf2 format_>`_,
* `sf3   <sf3 format_>`_,
* `sfz   <sfz format_>`_,
* `sfArk <sfark format_>`_.


.. _sf2 format:

Формат sf2
----------

Формат sf2 — это основной формат, с которым работает Polyphone.
Каждый файл sf2 содержит один или несколько виртуальных музыкальных инструментов, состоящих из звуковых семплов и множества параметров.
Параметры определяют, как следует воспроизводить семплы на клавиатуре, возможно, модулируя предопределёнными сигналами (модуляторами).
Файлы Sf2 построены в соответствии с трёхуровневой структурой:

* :ref:`семплы <sample editor>`, например, из трубы или фортепиано,
* :ref:`инструменты <instrument editor>`, созданные из семплов,
* :ref:`пресеты <preset editor>`, созданные из инструментов.

В дополнение к определению и настройке этих элементов файл sf2 также содержит :ref:`общую информацию <edit general>` (автор, авторское право, время редактирования и т.д.).

Файлы SoundFont используются программными синтезаторами, такими как Fluidsynth, воспроизводящими звук, используя волновые таблицы, и управляемые :abbr:`MIDI (Musical Instrument Digital Interface)`-сигналами.
Также можно использовать SoundFont sf2 для прослушивания файлов :abbr:`MIDI (Musical Instrument Digital Interface)` с помощью TiMidity_, WildMIDI_ или QuickTime и прослушивания партитур с помощью MuseScore_.
Аппаратные средства, такие как сэмплеры, звуковые карты или даже синтезаторы, также могут поддерживать формат .sf2.

Дополнительную информацию о SoundFont можно найти, например, в `Википедии <SoundFont_>`_.
Доступны спецификации sf2 для `версии 2.01 <https://www.polyphone-soundfonts.com/downloads/sf_specifications_v2.01.pdf>`_ и `версии 2.04 <https://www.polyphone-soundfonts.com/downloads/sf_specifications_v2.04.pdf>`_.


.. _sf3 format:

Формат sf3
----------

Формат sf3, разработанный MuseScore_, во всех отношениях похож на формат sf2, за исключением того, что :ref:`семплы <sample editor>` хранятся в формате OGG (как MP3, но с открытым исходным кодом), а не в виде необработанных данных.
В результате формат sf3 примерно в 10 раз легче формата sf2 при сопоставимом качестве.

SoundFont, экспортируемый в этом формате, не предназначен для последующего редактирования, поскольку последовательные сжатия приводят к снижению качества звука.
Этот формат следует рассматривать как конечный продукт, и он очень интересен для всех конечных пользователей звуковых шрифтов своими качествами:

* загрузка из интернета становится проще,
* требуется меньше дискового пространства в компьютерах,
* комбинация MIDI + sf3 обеспечивает лёгкое и мощное решение для воспроизведения саундтреков (видеоигры, мобильные приложения и т.д.).

В отличие от формата sf2pack_, который решает те же проблемы, формат sf3 полностью открыт.
Доступен исходный код, что обеспечивает его устойчивость (давайте избежим ошибок, допущенных sfArk и sfPack!).


.. _sfz format:

Формат sfz
----------

Формат sfz преследует ту же цель, что и формат sf2: создать музыкальный инструмент, расположить и настроить семплы на клавиатуре.
Основное отличие состоит в том, что формат sf2 — это всего 1 файл, содержащий всё, а формат sfz — это текстовый файл, поставляемый с набором семплов .wav.
Поскольку он предназначался для редактирования человеком, основным преимуществом было редактирование файла без необходимости в сложном редакторе.
Но редактор по-прежнему настоятельно рекомендуется для больших инструментов, количество параметров действительно может быстро обескуражить.
Формат sfz также определён не так строго, как формат sf2: могут возникнуть различия в способе редактирования и способах игры на инструменте sfz.


Ограничения при импорте sfz
^^^^^^^^^^^^^^^^^^^^^^^^^^^

* Импортируются только коды операций, имеющие аналог в :ref:`таблицах <instrument editor table>`.
* Огибающие, применяемые к высоте тона и к фильтру, становятся одной и той же огибающей в файлах sf2 (Mod env), импорт раздельных огибающих для высоты тона и для фильтра невозможен (коды операций ``fileg_*`` и ``pitcheg_*``).
* Генераторы низкой частоты (ГНЧ, LFO), применяемые к громкости и к фильтру, становятся одним ГНЧ в файлах sf2 (Mod LFO), импорт раздельных ГНЧ для громкости и для фильтра невозможен (коды операций ``amplfo_*`` и ``fillfo_*``).
* Единственный фильтр, который можно импортировать, это фильтр нижних частот (ФНЧ) второго порядка (``fil_type=lpf_2p``).
* Для правильного импорта коды операций ``group`` и ``off_by`` должны содержать одно и то же значение в одной группе.

.. warning::
   Коды операций ``width`` и ``position`` могут быть интерпретированы неправильно.


Ограничения при экспорте sfz
^^^^^^^^^^^^^^^^^^^^^^^^^^^^

* В настоящее время :ref:`модуляторы <instrument editor modulator>` не экспортируются.
* Формат sfz (версия 1) допускает только одну модуляцию высоты тона, два параметра :guilabel:`Виб. ГНЧ → высота тона (цент)` и :guilabel:`Модулятор ГНЧ → высота тона (цент)` не могут быть экспортированы одновременно.
* Цикл 0-1 можно экспортировать, но он игнорируется большинством проигрывателей sfz.
* 24-битный формат семплов может не поддерживаться некоторыми синтезаторами, пожалуйста, обратитесь к описанию поддерживаемых ими форматов.


В целом
^^^^^^^

Соответствие уровней звука (в дБ) в процессе преобразования sfz / sf2 было протестировано с помощью программы Sforzando.
Однако могут остаться некоторые различия.

Способ, которым параметры изменяются в соответствии с клавишей (используя :guilabel:`Клавиша → Огиб. громк.: удержание / спад` и :guilabel:`Клавиша → Огиб. мод.: удержание / спад`) не имеет точного соответствия.
Формат sf2 использует экспоненциальный закон для определения продолжительности удержания и спада в соответствии с клавишей, в то время как формат sfz использует линейный закон.


.. _sfark format:

Архивы sfArk
------------

Архивы sfArk, как и формат sf3, представляют собой сжатый формат.
Это означает, что качество звука немного снижено (но, чаще всего, незаметно).
Этот формат устарел, поэтому Polyphone позволяет только импортировать архивы sfArk (но не экспортировать).


.. внешние ссылки:

.. _TiMidity:  https://sourceforge.net/projects/timidity
.. _WildMIDI:  https://www.mindwerks.net/projects/wildmidi
.. _MuseScore: https://musescore.org/
.. _SoundFont: https://en.wikipedia.org/wiki/SoundFont
.. _sf2pack:   http://www.fmjsoft.com/fmt/sf2pack.htm
